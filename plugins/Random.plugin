# –ü–ª–∞–≥–∏–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ PluginGRT - @PluginIDEbot
__id__ = "random_number_generator_pg"
__name__ = "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª"
__description__ = "–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ.\n\n**–ö–æ–º–∞–Ω–¥—ã:**\n‚Ä¢ `.random <—á–∏—Å–ª–æ1> <—á–∏—Å–ª–æ2>` - –≤—ã–±–æ—Ä –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.\n‚Ä¢ `.trandom <—á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª>` - –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞.\n\n\n–ö–∞–Ω–∞–ª —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞\nhttps://t.me/Plugin20345"
__version__ = "1.1.0"
__author__ = "@Vadim20345"
__min_version__ = "11.12.0"
__icon__ = "sPluginIDE/41"

from base_plugin import BasePlugin, HookResult, HookStrategy
from ui.bulletin import BulletinHelper
from client_utils import get_last_fragment
import random
import re
from typing import Any

class RandomNumberPlugin(BasePlugin):
    """
    –ü–ª–∞–≥–∏–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞.
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏ –∏–∑ —Å–ø–∏—Å–∫–∞ —á–∏—Å–µ–ª.
    """
    def on_plugin_load(self):
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ö—É–∫ –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        self.add_on_send_message_hook()

    def on_send_message_hook(self, account: int, params: Any) -> HookResult:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–±—Ä–µ–∑–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
        msg = params.message.strip()
        msg_lower = msg.lower()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥—ã ".random"
        if msg_lower.startswith(".random "):
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–≤—É—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª
            # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ –∏ —á–∏—Å–ª–∞ –±–µ–∑ –∑–Ω–∞–∫–∞
            match_pg = re.match(r"^\.random\s+(-?\d+)\s+(-?\d+)$", msg_lower)

            if match_pg:
                try:
                    num1_pg = int(match_pg.group(1))
                    num2_pg = int(match_pg.group(2))

                    if num1_pg > num2_pg:
                        num1_pg, num2_pg = num2_pg, num1_pg

                    random_pg_number = random.randint(num1_pg, num2_pg)

                    # –ú—è—É! üêæ
                    params.message = f"–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –º–µ–∂–¥—É {num1_pg} –∏ {num2_pg}: *{random_pg_number}*"
                    
                    return HookResult(strategy=HookStrategy.MODIFY, params=params)

                except ValueError:
                    BulletinHelper.show_error(
                        "–û—à–∏–±–∫–∞: –í–≤–µ–¥–∏—Ç–µ –¥–≤–∞ —Ü–µ–ª—ã—Ö —á–∏—Å–ª–∞ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã. –ü—Ä–∏–º–µ—Ä: .random 1 10", 
                        get_last_fragment()
                    )
                    return HookResult(strategy=HookStrategy.CANCEL)
            else:
                BulletinHelper.show_error(
                    "–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: .random <—á–∏—Å–ª–æ1> <—á–∏—Å–ª–æ2>", 
                    get_last_fragment()
                )
                return HookResult(strategy=HookStrategy.CANCEL)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã ".trandom"
        elif msg_lower.startswith(".trandom "):
            # –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å —á–∏—Å–ª–∞–º–∏
            numbers_str = msg[len(".trandom "):].strip()
            
            # –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ –ø—Ä–æ–±–µ–ª–∞–º, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫
            number_list_str = numbers_str.split()

            if not number_list_str:
                BulletinHelper.show_error(
                    "–û—à–∏–±–∫–∞: –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã.", 
                    get_last_fragment()
                )
                return HookResult(strategy=HookStrategy.CANCEL)

            try:
                # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ –≤ —Å–ø–∏—Å–æ–∫ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª
                pg_numbers_list = [int(n) for n in number_list_str]

                # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –∏–∑ —Å–ø–∏—Å–∫–∞
                chosen_pg_number = random.choice(pg_numbers_list)

                # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                # #>^_^<#
                params.message = f"–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ —Å—Ä–µ–¥–∏ {numbers_str}: *{chosen_pg_number}*"
                
                return HookResult(strategy=HookStrategy.MODIFY, params=params)

            except ValueError:
                # –ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Å–æ–æ–±—â–∞–µ–º –æ–± –æ—à–∏–±–∫–µ
                BulletinHelper.show_error(
                    "–û—à–∏–±–∫–∞: –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏. –ü—Ä–∏–º–µ—Ä: .trandom 9 3 5", 
                    get_last_fragment()
                )
                return HookResult(strategy=HookStrategy.CANCEL)

        # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ–π –∏–∑ –∫–æ–º–∞–Ω–¥, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        return HookResult()