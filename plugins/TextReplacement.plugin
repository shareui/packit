# author - @ImaImap
from base_plugin import BasePlugin, HookStrategy, HookResult, MethodHook
from android_utils import log
from ui.settings import Header, Selector, Switch
from org.telegram.messenger import LocaleController
from org.telegram.ui.Components import ChatActivityEnterView
import re

__id__ = "TextReplacement"
__name__ = "Replacing the text style"
__description__ = "ĞœĞµĞ½ÑĞµÑ‚ ÑÑ‚Ğ¸Ğ»ÑŒ Ğ²Ğ°ÑˆĞ¸Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹"
__author__ = "@MorePlugins"
__version__ = "1.1"
__icon__ = "NewsEmoji/14"
__min_version__ = "11.9.0"

# style text
STYLES = {
    'sá´ÊŸá´„á´€á´˜': {
        'Ğµ': 'á´‡', 'Ñ‚': 'á´›', 'Ğ¾': 'á´', 'Ñ€': 'á´˜', 'Ğ°': 'á´€', 'Ğ½': 'Êœ', 'Ğº': 'á´‹', 'Ñ…': 'x', 'Ñ': 'á´„', 'Ğ²': 'Ê™', 'Ğ¼': 'á´',
        'Ğ™': 'Ğ¹', 'Ğ¦': 'Ñ†', 'Ğ£': 'Ñƒ', 'Ğ“': 'Ğ³', 'Ğ¨': 'Ñˆ', 'Ğ©': 'Ñ‰', 'Ğ—': 'Ğ·', 'Ğ¥': 'x', 'Ğ¤': 'Ñ„', 'Ğ«': 'Ñ‹', 'ĞŸ': 'Ğ¿',
        'Ğ›': 'Ğ»', 'Ğ”': 'Ğ´', 'Ğ–': 'Ğ¶', 'Ğ­': 'Ñ', 'Ğ¯': 'Ñ', 'Ğ§': 'Ñ‡', 'Ğ˜': 'Ğ¸', 'Ğ¬': 'ÑŒ', 'Ğ‘': 'Ğ±', 'Ğ®': 'Ñ',
        '1': 'ğŸ·', '2': 'ğŸ¸', '3': 'ğŸ¹', '4': 'ğŸº', '5': 'ğŸ»', '6': 'ğŸ¼', '7': 'ğŸ½', '8': 'ğŸ¾', '9': 'ğŸ¿', '0': 'ğŸ¶'
    },
    'DashUnderline': {
        'Ğ°': 'Ğ°Ì ', 'Ğ±': 'Ğ±Ì ', 'Ğ²': 'Ğ²Ì ', 'Ğ³': 'Ğ³Ì ', 'Ğ´': 'Ğ´Ì ', 'Ğµ': 'ĞµÌ ', 'Ñ‘': 'Ñ‘Ì ', 'Ğ¶': 'Ğ¶Ì ', 'Ğ·': 'Ğ·Ì ', 'Ğ¸': 'Ğ¸Ì ',
        'Ğ¹': 'Ğ¹Ì ', 'Ğº': 'ĞºÌ ', 'Ğ»': 'Ğ»Ì ', 'Ğ¼': 'Ğ¼Ì ', 'Ğ½': 'Ğ½Ì ', 'Ğ¾': 'Ğ¾Ì ', 'Ğ¿': 'Ğ¿Ì ', 'Ñ€': 'Ñ€Ì ', 'Ñ': 'ÑÌ ', 'Ñ‚': 'Ñ‚Ì ',
        'Ñƒ': 'ÑƒÌ ', 'Ñ„': 'Ñ„Ì ', 'Ñ…': 'Ñ…Ì ', 'Ñ†': 'Ñ†Ì ', 'Ñ‡': 'Ñ‡Ì ', 'Ñˆ': 'ÑˆÌ ', 'Ñ‰': 'Ñ‰Ì ', 'ÑŠ': 'ÑŠÌ ', 'Ñ‹': 'Ñ‹Ì ', 'ÑŒ': 'ÑŒÌ ',
        'Ñ': 'ÑÌ ', 'Ñ': 'ÑÌ ', 'Ñ': 'ÑÌ ',
        'Ğ': 'ĞÌ ', 'Ğ‘': 'Ğ‘Ì ', 'Ğ’': 'Ğ’Ì ', 'Ğ“': 'Ğ“Ì ', 'Ğ”': 'Ğ”Ì ', 'Ğ•': 'Ğ•Ì ', 'Ğ': 'ĞÌ ', 'Ğ–': 'Ğ–Ì ', 'Ğ—': 'Ğ—Ì ', 'Ğ˜': 'Ğ˜Ì ',
        'Ğ™': 'Ğ™Ì ', 'Ğš': 'ĞšÌ ', 'Ğ›': 'Ğ›Ì ', 'Ğœ': 'ĞœÌ ', 'Ğ': 'ĞÌ ', 'Ğ': 'ĞÌ ', 'ĞŸ': 'ĞŸÌ ', 'Ğ ': 'Ğ Ì ', 'Ğ¡': 'Ğ¡Ì ', 'Ğ¢': 'Ğ¢Ì ',
        'Ğ£': 'Ğ£Ì ', 'Ğ¤': 'Ğ¤Ì ', 'Ğ¥': 'Ğ¥Ì ', 'Ğ¦': 'Ğ¦Ì ', 'Ğ§': 'Ğ§Ì ', 'Ğ¨': 'Ğ¨Ì ', 'Ğ©': 'Ğ©Ì ', 'Ğª': 'ĞªÌ ', 'Ğ«': 'Ğ«Ì ', 'Ğ¬': 'Ğ¬Ì ',
        'Ğ­': 'Ğ­Ì ', 'Ğ®': 'Ğ®Ì ', 'Ğ¯': 'Ğ¯Ì ',
        '1': '1Ì ', '2': '2Ì ', '3': '3Ì ', '4': '4Ì ', '5': '5Ì ', '6': '6Ì ', '7': '7Ì ', '8': '8Ì ', '9': '9Ì ', '0': '0Ì '
    },
    'ğšƒğš¢ğš™ğšğš ğš›ğš’ğšğšğš›': {
        'a': 'ğšŠ', 'b': 'ğš‹', 'c': 'ğšŒ', 'd': 'ğš', 'e': 'ğš', 'f': 'ğš', 'g': 'ğš', 'h': 'ğš‘', 'i': 'ğš’', 'j': 'ğš“',
        'k': 'ğš”', 'l': 'ğš•', 'm': 'ğš–', 'n': 'ğš—', 'o': 'ğš˜', 'p': 'ğš™', 'q': 'ğšš', 'r': 'ğš›', 's': 'ğšœ', 't': 'ğš',
        'u': 'ğš', 'v': 'ğšŸ', 'w': 'ğš ', 'x': 'ğš¡', 'y': 'ğš¢', 'z': 'ğš£',
        'A': 'ğ™°', 'B': 'ğ™±', 'C': 'ğ™²', 'D': 'ğ™³', 'E': 'ğ™´', 'F': 'ğ™µ', 'G': 'ğ™¶', 'H': 'ğ™·', 'I': 'ğ™¸', 'J': 'ğ™¹',
        'K': 'ğ™º', 'L': 'ğ™»', 'M': 'ğ™¼', 'N': 'ğ™½', 'O': 'ğ™¾', 'P': 'ğ™¿', 'Q': 'ğš€', 'R': 'ğš', 'S': 'ğš‚', 'T': 'ğšƒ',
        'U': 'ğš„', 'V': 'ğš…', 'W': 'ğš†', 'X': 'ğš‡', 'Y': 'ğšˆ', 'Z': 'ğš‰'
    },
    'ğ˜½ğ™Šğ™‡ğ˜¿ğ™„ğ™ğ˜¼ğ™‡ğ™„ğ˜¾': {
        'a': 'ğ™–', 'b': 'ğ™—', 'c': 'ğ™˜', 'd': 'ğ™™', 'e': 'ğ™š', 'f': 'ğ™›', 'g': 'ğ™œ', 'h': 'ğ™', 'i': 'ğ™', 'j': 'ğ™Ÿ',
        'k': 'ğ™ ', 'l': 'ğ™¡', 'm': 'ğ™¢', 'n': 'ğ™£', 'o': 'ğ™¤', 'p': 'ğ™¥', 'q': 'ğ™¦', 'r': 'ğ™§', 's': 'ğ™¨', 't': 'ğ™©',
        'u': 'ğ™ª', 'v': 'ğ™«', 'w': 'ğ™¬', 'x': 'ğ™­', 'y': 'ğ™®', 'z': 'ğ™¯',
        'A': 'ğ˜¼', 'B': 'ğ˜½', 'C': 'ğ˜¾', 'D': 'ğ˜¿', 'E': 'ğ™€', 'F': 'ğ™', 'G': 'ğ™‚', 'H': 'ğ™ƒ', 'I': 'ğ™„', 'J': 'ğ™…',
        'K': 'ğ™†', 'L': 'ğ™‡', 'M': 'ğ™ˆ', 'N': 'ğ™‰', 'O': 'ğ™Š', 'P': 'ğ™‹', 'Q': 'ğ™Œ', 'R': 'ğ™', 'S': 'ğ™', 'T': 'ğ™',
        'U': 'ğ™', 'V': 'ğ™‘', 'W': 'ğ™’', 'X': 'ğ™“', 'Y': 'ğ™”', 'Z': 'ğ™•'
    },
    'ğ—¶ğ˜ğ—®ğ—¹ğ—¶ğ—°': {
        'a': 'ğ˜¢', 'b': 'ğ˜£', 'c': 'ğ˜¤', 'd': 'ğ˜¥', 'e': 'ğ˜¦', 'f': 'ğ˜§', 'g': 'ğ˜¨', 'h': 'ğ˜©', 'i': 'ğ˜ª', 'j': 'ğ˜«',
        'k': 'ğ˜¬', 'l': 'ğ˜­', 'm': 'ğ˜®', 'n': 'ğ˜¯', 'o': 'ğ˜°', 'p': 'ğ˜±', 'q': 'ğ˜²', 'r': 'ğ˜³', 's': 'ğ˜´', 't': 'ğ˜µ',
        'u': 'ğ˜¶', 'v': 'ğ˜·', 'w': 'ğ˜¸', 'x': 'ğ˜¹', 'y': 'ğ˜º', 'z': 'ğ˜»',
        'A': 'ğ˜ˆ', 'B': 'ğ˜‰', 'C': 'ğ˜Š', 'D': 'ğ˜‹', 'E': 'ğ˜Œ', 'F': 'ğ˜', 'G': 'ğ˜', 'H': 'ğ˜', 'I': 'ğ˜', 'J': 'ğ˜‘',
        'K': 'ğ˜’', 'L': 'ğ˜“', 'M': 'ğ˜”', 'N': 'ğ˜•', 'O': 'ğ˜–', 'P': 'ğ˜—', 'Q': 'ğ˜˜', 'R': 'ğ˜™', 'S': 'ğ˜š', 'T': 'ğ˜›',
        'U': 'ğ˜œ', 'V': 'ğ˜', 'W': 'ğ˜', 'X': 'ğ˜Ÿ', 'Y': 'ğ˜ ', 'Z': 'ğ˜¡'
    },
    'ğ—•ğ—¼ğ—¹ğ—±': {
        'a': 'ğ—®', 'b': 'ğ—¯', 'c': 'ğ—°', 'd': 'ğ—±', 'e': 'ğ—²', 'f': 'ğ—³', 'g': 'ğ—´', 'h': 'ğ—µ', 'i': 'ğ—¶', 'j': 'ğ—·',
        'k': 'ğ—¸', 'l': 'ğ—¹', 'm': 'ğ—º', 'n': 'ğ—»', 'o': 'ğ—¼', 'p': 'ğ—½', 'q': 'ğ—¾', 'r': 'ğ—¿', 's': 'ğ˜€', 't': 'ğ˜',
        'u': 'ğ˜‚', 'v': 'ğ˜ƒ', 'w': 'ğ˜„', 'x': 'ğ˜…', 'y': 'ğ˜†', 'z': 'ğ˜‡',
        'A': 'ğ—”', 'B': 'ğ—•', 'C': 'ğ—–', 'D': 'ğ——', 'E': 'ğ—˜', 'F': 'ğ—™', 'G': 'ğ—š', 'H': 'ğ—›', 'I': 'ğ—œ', 'J': 'ğ—',
        'K': 'ğ—', 'L': 'ğ—Ÿ', 'M': 'ğ— ', 'N': 'ğ—¡', 'O': 'ğ—¢', 'P': 'ğ—£', 'Q': 'ğ—¤', 'R': 'ğ—¥', 'S': 'ğ—¦', 'T': 'ğ—§',
        'U': 'ğ—¨', 'V': 'ğ—©', 'W': 'ğ—ª', 'X': 'ğ—«', 'Y': 'ğ—¬', 'Z': 'ğ—­',
        '1': 'ğŸ­', '2': 'ğŸ®', '3': 'ğŸ¯', '4': 'ğŸ°', '5': 'ğŸ±', '6': 'ğŸ²', '7': 'ğŸ³', '8': 'ğŸ´', '9': 'ğŸµ', '0': 'ğŸ¬'
    },
    'ğ“ğ‡ğ˜ğğ¨ğ¥ğ': {
        'a': 'ğš', 'b': 'ğ›', 'c': 'ğœ', 'd': 'ğ', 'e': 'ğ', 'f': 'ğŸ', 'g': 'ğ ', 'h': 'ğ¡', 'i': 'ğ¢', 'j': 'ğ£',
        'k': 'ğ¤', 'l': 'ğ¥', 'm': 'ğ¦', 'n': 'ğ§', 'o': 'ğ¨', 'p': 'ğ©', 'q': 'ğª', 'r': 'ğ«', 's': 'ğ¬', 't': 'ğ­',
        'u': 'ğ®', 'v': 'ğ¯', 'w': 'ğ°', 'x': 'ğ±', 'y': 'ğ²', 'z': 'ğ³',
        'A': 'ğ€', 'B': 'ğ', 'C': 'ğ‚', 'D': 'ğƒ', 'E': 'ğ„', 'F': 'ğ…', 'G': 'ğ†', 'H': 'ğ‡', 'I': 'ğˆ', 'J': 'ğ‰',
        'K': 'ğŠ', 'L': 'ğ‹', 'M': 'ğŒ', 'N': 'ğ', 'O': 'ğ', 'P': 'ğ', 'Q': 'ğ', 'R': 'ğ‘', 'S': 'ğ’', 'T': 'ğ“',
        'U': 'ğ”', 'V': 'ğ•', 'W': 'ğ–', 'X': 'ğ—', 'Y': 'ğ˜', 'Z': 'ğ™',
        '1': 'ğŸ', '2': 'ğŸ', '3': 'ğŸ‘', '4': 'ğŸ’', '5': 'ğŸ“', '6': 'ğŸ”', '7': 'ğŸ•', '8': 'ğŸ–', '9': 'ğŸ—', '0': 'ğŸ'
    }
}

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ±ÑƒĞºĞ²Ñ‹
for cyrillic_upper in 'Ğ•Ğ¢ĞĞ ĞĞĞšĞ¥Ğ¡Ğ’Ğœ':
    lower = cyrillic_upper.lower()
    if lower in STYLES['sá´ÊŸá´„á´€á´˜']:
        STYLES['sá´ÊŸá´„á´€á´˜'][cyrillic_upper] = STYLES['sá´ÊŸá´„á´€á´˜'][lower]

def apply_style(text: str, style_name: str) -> str:
    if style_name not in STYLES:
        return text
    style_dict = STYLES[style_name]
    return ''.join(style_dict.get(char, char) for char in text)

def is_telegram_linkable(token: str) -> bool:
    """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚, Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ»Ğ¸ Ñ‚ĞµĞºÑÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ¾ ÑÑ‚Ğ¸Ğ»ĞµĞ¼"""
    if token.startswith('@') and len(token) > 1:
        rest = token[1:]
        if rest.replace('_', '').isalnum() and rest[0].isalpha():
            return True
    if token.isdigit() and 5 <= len(token) <= 15:
        return True
    clean = token.lstrip('+')
    if clean != token and clean.isdigit() and 7 <= len(clean) <= 15:
        return True
    if token.isdigit() and 7 <= len(token) <= 15:
        return True
    return False

def process_text_preserve_links(text: str, russian_style: str, english_style: str) -> str:
    # Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ½Ğ° ÑĞ»Ğ¾Ğ²Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹ Ğ¸ Ğ¿ÑƒĞ½ĞºÑ‚ÑƒĞ°Ñ† ĞºĞ°Ğº Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ğ¸
    tokens = re.findall(r'\S+|\s+', text)
    result = []
    for token in tokens:
        if token.isspace():
            result.append(token)
            continue

        stripped = token.strip('.,;:!?()[]{}"\'Â«Â»')
        prefix = token[:len(token) - len(stripped.lstrip('.,;:!?()[]{}"\'Â«Â»'))]
        suffix = token[len(prefix) + len(stripped.rstrip('.,;:!?()[]{}"\'Â«Â»')):]
        core = stripped.strip('.,;:!?()[]{}"\'Â«Â»')

        if core and is_telegram_linkable(core):
            result.append(prefix + core + suffix)
        else:
            styled = token
            has_cyrillic = any('Ğ°' <= c <= 'Ñ' or 'Ğ' <= c <= 'Ğ¯' for c in token)
            has_latin = any('a' <= c <= 'z' or 'A' <= c <= 'Z' for c in token)
            if has_cyrillic and russian_style:
                styled = apply_style(styled, russian_style)
            if has_latin and english_style:
                styled = apply_style(styled, english_style)
            result.append(styled)
    return ''.join(result)

class FormatInterceptor(MethodHook):
    def __init__(self, plugin):
        self.plugin = plugin

    def before_hooked_method(self, param):
        try:
            if not self.plugin.get_setting("enabled", True):
                return

            enter_view = param.thisObject
            text_field = enter_view.getEditField()
            if not text_field:
                return

            original_text = text_field.getText()
            if not original_text or not original_text.toString().strip():
                return

            format_index = self.plugin.get_setting("message_format", 0)
            russian_idx = self.plugin.get_setting("russian_style", 0)
            english_idx = self.plugin.get_setting("english_style", 0)

            if format_index == 0 and russian_idx == 0 and english_idx == 0:
                return

            russian_styles = ["Ğ‘ĞµĞ· ÑÑ‚Ğ¸Ğ»Ñ", "sá´ÊŸá´„á´€á´˜", "DashUnderline"]
            english_styles = ["Ğ‘ĞµĞ· ÑÑ‚Ğ¸Ğ»Ñ", "ğšƒğš¢ğš™ğšğš ğš›ğš’ğšğšğš›", "ğ˜½ğ™Šğ™‡ğ˜¿ğ™„ğ™ğ˜¼ğ™‡ğ™„ğ‚", "ğ—¶ğ˜ğ—®ğ—¹ğ—¶ğ—°", "ğ—•ğ—¼ğ—¹ğ—±", "ğ“ğ‡ğ˜ğğ¨ğ¥ğ"]
            russian_style = russian_styles[russian_idx] if 0 < russian_idx < len(russian_styles) else ""
            english_style = english_styles[english_idx] if 0 < english_idx < len(english_styles) else ""

            original_str = original_text.toString()
            processed = process_text_preserve_links(original_str, russian_style, english_style)

            if processed != original_str:
                text_field.setText(processed)

            # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹
            current_text = text_field.getText()
            current_length = current_text.length()
            text_field.setSelection(0, current_length)

            if format_index == 1:
                text_field.makeSelectedBold()
            elif format_index == 2:
                text_field.makeSelectedItalic()
            elif format_index == 3:
                text_field.makeSelectedMono()
            elif format_index == 4:
                text_field.makeSelectedQuote(True)
            elif format_index == 5:
                text_field.makeSelectedSpoiler()
            elif format_index == 6:
                text_field.makeSelectedBold()
                text_field.makeSelectedItalic()

            text_field.setSelection(current_length, current_length)

        except Exception as e:
            log(f"[TextReplacement] Error: {e}")

class TextReplacement(BasePlugin):
    def create_settings(self):
        lang = LocaleController.getInstance().getCurrentLocale().getLanguage()
        is_ru = lang.startswith("ru")

        format_items = [
            "Ğ‘ĞµĞ· Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°",
            "Ğ–Ğ¸Ñ€Ğ½Ñ‹Ğ¹",
            "ĞšÑƒÑ€ÑĞ¸Ğ²",
            "ĞœĞ¾Ğ½Ğ¾",
            "Ğ¦Ğ¸Ñ‚Ğ°Ñ‚Ğ°",
            "Ğ¡ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹",
            "Ğ–Ğ¸Ñ€Ğ½Ñ‹Ğ¹+ĞšÑƒÑ€ÑĞ¸Ğ²"
        ] if is_ru else [
            "No format",
            "Bold",
            "Italic",
            "Monospace",
            "Quote",
            "Spoiler",
            "Bold+Italic"
        ]

        style_items_ru = ["Ğ‘ĞµĞ· ÑÑ‚Ğ¸Ğ»Ñ", "sá´ÊŸá´„á´€á´˜", "DashUnderline"]
        style_items_en = ["Ğ‘ĞµĞ· ÑÑ‚Ğ¸Ğ»Ñ", "ğšƒğš¢ğš™ğšğš ğš›ğš’ğšğšğš›", "ğ˜½ğ™Šğ™‡ğ˜¿ğ™„ğ™ğ˜¼ğ™‡ğ™„ğ‚", "ğ—¶ğ˜ğ—®ğ—¹ğ—¶ğšŒ", "ğ—•ğ—¼ğ—¹ğ—±", "ğ“ğ‡ğ˜ğğ¨ğ¥ğ"]

        if not is_ru:
            style_items_ru = ["No style", "sá´ÊŸá´„á´€á´˜", "DashUnderline"]
            style_items_en = ["No style", "ğšƒğš¢ğš™ğšğš ğš›ğš’ğšğšğš›", "ğ˜½ğ™Šğ™‡ğ˜¿ğ™„ğ™ğ˜¼ğ™‡ğ™„ğ‚", "italic", "ğ—•ğ—¼ğ—¹ğ—±", "ğ“ğ‡ğ˜ğğ¨ğ¥ğ"]

        settings = [
            Header(text="Text Replacement" if not is_ru else "Ğ—Ğ°Ğ¼ĞµĞ½Ğ° Ñ‚ĞµĞºÑÑ‚Ğ°"),
            Switch(
                key="enabled",
                text="Enable text replacement" if not is_ru else "Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¼ĞµĞ½Ñƒ Ñ‚ĞµĞºÑÑ‚Ğ°",
                default=True,
                icon="msg_style"
            ),
            Header(text="Formatting" if not is_ru else "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"),
            Selector(
                key="message_format",
                text="Text format" if not is_ru else "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ‚ĞµĞºÑÑ‚Ğ°",
                default=0,
                items=format_items,
                icon="msg_text_outlined"
            ),
            Header(text="Russian Text" if not is_ru else "Ğ ÑƒÑÑĞºĞ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚"),
            Selector(
                key="russian_style",
                text="Russian text style" if not is_ru else "Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ğ ÑƒÑÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°",
                default=0,
                items=style_items_ru,
                icon="msg_emoji"
            ),
            Header(text="English Text" if not is_ru else "ĞĞ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚"),
            Selector(
                key="english_style",
                text="English text style" if not is_ru else "Ğ¡Ñ‚Ğ¸Ğ»ÑŒ ĞĞ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°",
                default=0,
                items=style_items_en,
                icon="msg_emoji"
            ),
        ]

        return settings

    def on_plugin_load(self):
        methods = ChatActivityEnterView.getClass().getDeclaredMethods()
        for method in methods:
            if method.getName() == "sendMessageInternal" and method.getParameterCount() == 4:
                self.hook_method(method, FormatInterceptor(self))
                break